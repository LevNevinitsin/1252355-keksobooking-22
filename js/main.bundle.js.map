{"version":3,"sources":["webpack://keksobooking/./source/js/util.js","webpack://keksobooking/./source/js/generate-ad-markup.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/popup.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/filter.js","webpack://keksobooking/./source/js/main.js","webpack://keksobooking/./source/js/server.js"],"names":["BORDER_CLASS","BORDER_ANIMATION_CLASS","getWordForm","number","wordForms","lastTwoCharsNum","lastChar","disableElements","elements","forEach","element","disabled","enableElements","addRedBorder","classList","add","addEventListener","remove","once","removeRedBorder","contains","apartmentsMap","ruLabel","price","createCapacityContent","roomsNumber","guestsNumber","fillOrRemove","isDataEnough","content","cb","cbParameters","textContent","adTemplate","document","querySelector","IMAGE_MESSAGE","SYMBOL_WORDS","fieldsets","querySelectorAll","avatar","avatarPreview","title","address","type","timeIn","timeOut","photo","photoBox","photoPreview","resetButton","setAddress","lat","lng","value","toFixed","setPriceAttributes","apartmentPrice","min","placeholder","syncTimeValues","from","to","selectedIndex","evt","target","confirmValidation","setCustomValidity","getTitleValidity","symbolsDifference","length","reportValidity","validateGuests","roomsValue","parseInt","guestsValue","areGuestsSynced","validityMessage","isImage","file","startsWith","confirmImageValidity","input","nextElementSibling","confirmAndPreview","preview","defaultSrc","block","reader","FileReader","src","result","readAsDataURL","setPreviewSrc","defaultAvatar","isPreviewAdded","removePreview","resetPhoto","files","createElement","width","height","alt","appendChild","main","requestError","postingSuccess","postingError","errorButton","cleanPopup","popup","removeEventListener","onPopupClick","window","onWindowKeydown","onErrorButtonClick","showPopup","createOnPopupClick","code","createOnWindowKeydown","CENTER_LAT","CENTER_LNG","map","L","tileLayer","attribution","addTo","mainMarkerIcon","icon","iconUrl","iconSize","iconAnchor","MAIN_MARKER_SIZE","mainMarker","marker","draggable","on","coordinates","getLatLng","markerIcon","MARKER_SIZE","markers","createMarkers","ads","ad","location","bindPopup","author","offer","rooms","guests","checkin","checkinTime","checkout","checkoutTime","features","description","photos","newAd","cloneNode","popupPrice","insertAdjacentHTML","popupType","popupTextCapacity","Boolean","popupTextTime","timeContent","popupFeaturesList","innerHTML","featuresFragment","createDocumentFragment","feature","newFeature","newFeatureModificator","generateFeaturesList","popupDescription","popupPhotosList","popupPhoto","photosFragment","photoSrc","newPhoto","generatePhotosList","popupAvatar","generateAdMarkup","keepInView","push","createMarker","reCreateMarkers","priceFilter","filter","selectFilters","filterElements","isAdMatched","isSelectsMatched","Array","every","select","selectType","name","split","adValue","toString","isSelectMatched","selectedFeatures","adFeatures","selectedFeature","includes","isFeaturesMatched","onFilterChange","ms","timer","clearTimeout","setTimeout","filteredAds","i","filterAds","filterMarkers","debounce","CENTER_COORDINATES","slicedAds","onSuccess","onFail","setFilterListener","slice","fetch","then","response","ok","json","data","catch","setView","setDefaults","reset","setLatLng","undefined","body","preventDefault","FormData","method"],"mappings":"mBAAA,MAAMA,EAAe,gBACfC,EAAyB,oBAEzBC,EAAc,CAACC,EAAQC,KAC3B,IAAIC,EAAkBF,EAAS,IAC3BG,EAAWD,EAAkB,GAEjC,OAAIA,EAAkB,IAAMA,EAAkB,GAAaD,EAAU,GACpD,IAAbE,EAAyBF,EAAU,GACnCE,EAAW,GAAKA,EAAW,EAAYF,EAAU,GACjDE,EAAW,GAAKA,EAAW,GAAKF,EAAU,GAAaA,EAAU,GAC7C,KAApBC,GAA0BD,EAAU,GAAaA,EAAU,GACtC,KAApBC,GAA8C,IAApBA,IAA0BD,EAAU,GAC5DA,EAAU,GAD+DA,EAAU,IAItFG,EAAmBC,IACvBA,EAASC,SAASC,IAChBA,EAAQC,UAAW,MAIjBC,EAAkBJ,IACtBA,EAASC,SAASC,IAChBA,EAAQC,UAAW,MAIjBE,EAAgBH,IACpBA,EAAQI,UAAUC,IAAIf,GACtBU,EAAQI,UAAUC,IAAId,GAEtBS,EAAQM,iBAAiB,gBAAgB,KACvCN,EAAQI,UAAUG,OAAOhB,KACxB,CAAEiB,MAAM,KAGPC,EAAmBT,IACnBA,EAAQI,UAAUM,SAASpB,IAC7BU,EAAQI,UAAUG,OAAOjB,ICrCvBqB,EAAgB,CACpB,KAAQ,CACNC,QAAS,WACTC,MAAO,KAET,SAAY,CACVD,QAAS,UACTC,MAAO,GAET,MAAS,CACPD,QAAS,MACTC,MAAO,KAET,OAAU,CACRD,QAAS,SACTC,MAAO,MA+BLC,EAAwB,EAAEC,EAAaC,KAIpC,GAAGD,KAHYvB,EAAYuB,EAAa,CAAC,UAAW,UAAW,kBAGxBC,KAFrBxB,EAAYwB,EAAc,CAAC,KAAM,IAAK,KAAM,KAAM,KAAM,UAC1DxB,EAAYwB,EAAc,CAAC,QAAS,SAAU,aAIjEC,EAAe,CAACC,EAAclB,EAASmB,EAASC,EAAIC,KACpDH,GACEE,IAAMD,EAAUC,EAAGC,IACvBrB,EAAQsB,YAAcH,GAEtBnB,EAAQO,UAINgB,EAAaC,SAASC,cAAc,SACvCN,QACAM,cAAc,UCvDXC,EAAgB,6BAChBC,EAAe,CACnB,SACA,UACA,YAKI,EAAOH,SAASC,cAAc,YAC9BG,EAAY,EAAKC,iBAAiB,YAClCC,EAAS,EAAKL,cAAc,WAC5BM,EAAgB,EAAKN,cAAc,gCACnCO,EAAQ,EAAKP,cAAc,UAC3BQ,EAAU,EAAKR,cAAc,YAC7BS,EAAO,EAAKT,cAAc,SAC1BZ,EAAQ,EAAKY,cAAc,UAC3BV,EAAc,EAAKU,cAAc,gBACjCT,EAAe,EAAKS,cAAc,aAClCU,EAAS,EAAKV,cAAc,WAC5BW,EAAU,EAAKX,cAAc,YAC7BY,EAAQ,EAAKZ,cAAc,WAC3Ba,EAAW,EAAKb,cAAc,mBACpC,IAAIc,EACJ,MAAM,EAAS,EAAKd,cAAc,oBAC5Be,EAAc,EAAKf,cAAc,mBAYjCgB,EAAa,EAAEC,EAAKC,MACxBV,EAAQW,MAAQ,GAAGF,EAAIG,QA9CK,OA8C8BF,EAAIE,QA9ClC,MAiDxBC,EAAqB,KACzB,MAAMC,EAAiBpC,EAAcuB,EAAKU,OAAO/B,MACjDA,EAAMmC,IAAMD,EACZlC,EAAMoC,YAAcF,GAGtBD,IAGAZ,EAAK5B,iBAAiB,UADD,IAAMwC,MAG3B,MAAMI,EAAiB,CAACC,EAAMC,KAC5BA,EAAGC,cAAgBF,EAAKE,eAM1BlB,EAAO7B,iBAAiB,UAHAgD,GAAQJ,EAAeI,EAAIC,OAAQnB,KAI3DA,EAAQ9B,iBAAiB,UAHAgD,GAAQJ,EAAeI,EAAIC,OAAQpB,KAK5D,MAAMqB,EAAqBxD,IACzBA,EAAQyD,kBAAkB,IAC1BhD,EAAgBT,IAGZ0D,EAAoBC,GAAsB,GAAGA,KAAqBnE,EAAYmE,EAAmBhC,KAkBvGK,EAAM1B,iBAAiB,SAhBF,KACnB,MAAMsD,EAAS5B,EAAMY,MAAMgB,OAE3B,GAAIA,EA/EmB,GA+EQ,CAC7B,MAAMD,EAhFe,GAgFwBC,EAC7C5B,EAAMyB,kBAAkB,gBAAgBC,EAAiBC,YACpD,GAAIC,EAjFY,IAiFe,CACpC,MAAMD,EAAoBC,EAlFL,IAmFrB5B,EAAMyB,kBAAkB,kBAAkBC,EAAiBC,YAE3DH,EAAkBxB,GAGpBA,EAAM6B,oBAiBRhD,EAAMP,iBAAiB,SAZF,KACLO,EAAM+B,MA7FJ,IAgGd/B,EAAM4C,kBAAkB,oCAExBD,EAAkB3C,GAGpBA,EAAMgD,oBAKR,MAAMC,EAAiB,KACrB,MAAMC,EAAaC,SAASjD,EAAY6B,OAClCqB,EAAcD,SAAShD,EAAa4B,OAE1C,IAAIsB,EACAC,EA9GoB,MAgHpBJ,GACFG,EAhHuB,IAgHLD,EAClBE,EAhHyB,8EAkHzBD,EAAkBD,GAAeF,GAnHV,IAmHwBE,EAC/CE,EAlHmB,sGAqHpBD,EAAoEV,EAAkBxC,GAApEA,EAAayC,kBAAkBU,GAElDnD,EAAa6C,kBAMf9C,EAAYT,iBAAiB,UAHD,IAAMwD,MAIlC9C,EAAaV,iBAAiB,UAHD,IAAMwD,MAKnC,MAAMM,EAAWC,GAASA,EAAKnC,KAAKoC,WAAW,SAgBzCC,EAAwBC,IAC5BA,EAAMf,kBAAkB,IACxBhD,EAAgB+D,EAAMC,qBAGlBC,EAAoB,CAACF,EAAOH,EAAMM,EAASC,KAC/CL,EAAqBC,GApBD,EAACH,EAAMQ,EAAOD,KAClC,GAAIP,EAAM,CACR,MAAMS,EAAS,IAAIC,WAEnBD,EAAOxE,iBAAiB,QAAQ,KAC9BuE,EAAMG,IAAMF,EAAOG,UAGrBH,EAAOI,cAAcb,QAErBQ,EAAMG,IAAMJ,GAWdO,CAAcd,EAAMM,EAASC,IAGzBQ,EAAgBrD,EAAciD,IAiB9BK,EAAiB,IAAM/C,EAAS5B,SAAS6B,GAEzC+C,EAAgB,KAChBD,KACF9C,EAAahC,UAIXgF,EAAcf,IAClBD,EAAqBC,GACrBc,KA8BFxD,EAAOxB,iBAAiB,UAvDD,KACrB,MAAM+D,EAAOvC,EAAO0D,MAAM,IAErBnB,GAAQD,EAAQC,GACnBK,EAAkB5C,EAAQuC,EAAMtC,EAAeqD,IAE/CtD,EAAO2B,kBAAkB/B,GACrBK,EAAciD,MAAQI,IACxBrD,EAAciD,IAAMI,IAIxBtD,EAAO+B,oBA4CTxB,EAAM/B,iBAAiB,UA5BD,KACpB,MAAM+D,EAAOhC,EAAMmD,MAAM,GAEpBjD,IACHA,EAAef,SAASiE,cAAc,OACtClD,EAAamD,MAtLI,GAuLjBnD,EAAaoD,OAvLI,GAwLjBpD,EAAaqD,IAvLG,2BA0LbvB,EAGED,EAAQC,IAIXK,EAAkBrC,EAAOgC,EAAM9B,GAC1B8C,KACH/C,EAASuD,YAAYtD,KALvBF,EAAMoB,kBAAkB/B,GACxB4D,KAJFC,EAAWlD,GAabA,EAAMwB,oBAWR,EAAOvD,iBAAiB,SALO,KACL,EAAKuB,iBAAiB,iCAC9B9B,SAASC,GAA6B,SAAjBA,EAAQkC,KAAkB/B,EAAaH,EAAQyE,oBAAsBtE,EAAaH,QClOzH,MAEM8F,EAAOtE,SAASC,cAAc,QAC9BsE,EAAevE,SAASC,cAAc,kBACzCN,QACAM,cAAc,UACXuE,EAAiBxE,SAASC,cAAc,YAC3CN,QACAM,cAAc,YACXwE,EAAezE,SAASC,cAAc,UACzCN,QACAM,cAAc,UACXyE,EAAcD,EAAaxE,cAAc,kBAEzC0E,EAAcC,IAClBA,EAAM7F,SACN6F,EAAMC,oBAAoB,QAASC,GACnCC,OAAOF,oBAAoB,UAAWG,IAalCC,EAAqB,KACzBN,EAAWF,GACXC,EAAYG,oBAAoB,QAASI,IAG3C,IAAIH,EACAE,EAEJ,MAAME,EAAaN,IACjBN,EAAKD,YAAYO,GACjBA,EAAM9F,iBAAiB,QAASgG,EApBP,CAACF,GAAU,IAAMD,EAAWC,GAoBNO,CAAmBP,IAClEG,OAAOjG,iBAAiB,UAAWkG,EAnBP,CAACJ,GACrB9C,IAvBU,WAwBZA,EAAIsD,MACNT,EAAWC,IAgBsCS,CAAsBT,IACvEA,EAAM1F,SAASwF,IACjBA,EAAY5F,iBAAiB,QAASmG,ICvCpCK,GAAa,QACbC,GAAa,WAKbC,GAAMC,EAAED,IAAI,cAElBC,EAAEC,UACA,qDACA,CACEC,YAAa,4FAEfC,MAAMJ,IAER,MAAMK,GAAiBJ,EAAEK,KAAM,CAC7BC,QAAS,sBACTC,SAAU,CAda,OAevBC,WAAY,CAACC,GAfU,MAkBnBC,GAAaV,EAAEW,OACnB,CACElF,IAAKoE,GACLnE,IAAKoE,IAEP,CACEc,WAAW,EACXP,KAAMD,KAIVM,GAAWP,MAAMJ,IAEjBW,GAAWG,GAAG,QAASxE,IACrB,MAAMyE,EAAc,CAACzE,EAAIC,OAAOyE,YAAYtF,IAAKY,EAAIC,OAAOyE,YAAYrF,KACxEF,EAAWsF,MAGb,MAAME,GAAahB,EAAEK,KAAM,CACzBC,QAAS,iBACTC,SAAU,CArCQ,OAsClBC,WAAY,CAACS,GAtCK,MAyCdC,GAAU,GAuBVC,GAAiBC,IACrBA,EAAItI,SAASuI,IAtBM,CAACA,IACpB,MAAMV,EAASX,EAAEW,OACf,CACElF,IAAK4F,EAAGC,SAAS7F,IACjBC,IAAK2F,EAAGC,SAAS5F,KAEnB,CACE2E,KAAMW,KAGVL,EACGR,MAAMJ,IACNwB,UHKoB,CAACF,IACxB,MACEG,QAAQ,OAAC3G,GACT4G,OAAO,MACL1G,EAAK,QACLC,EAAO,MACPpB,EAAK,KACLqB,EACAyG,MAAO5H,EACP6H,OAAQ5H,EACR6H,QAASC,EACTC,SAAUC,EAAY,SACtBC,EAAQ,YACRC,EAAW,OACXC,IAEAb,EACEc,EAAQ7H,EAAW8H,WAAU,GACnCD,EAAM3H,cAAc,iBAAiBH,YAAcU,EACnDoH,EAAM3H,cAAc,yBAAyBH,YAAcW,EAE3D,MAAMqH,EAAaF,EAAM3H,cAAc,uBAEvC6H,EAAWhI,YAAc,GAAGT,IAC5ByI,EAAWC,mBAAmB,YAFjB,wBAIb,MAAMC,EAAYJ,EAAM3H,cAAc,gBACtCR,EAAaiB,EAAMsH,EAAW7I,EAAcuB,GAAMtB,SAElD,MAAM6I,EAAoBL,EAAM3H,cAAc,0BAC9C,IAAIP,EAAewI,QAAQ3I,IAAgB2I,QAAQ1I,GACnDC,EAAaC,EAAcuI,EAAmB,GAAI3I,EAAuB,CAACC,EAAaC,IAEvF,MAAM2I,EAAgBP,EAAM3H,cAAc,sBACpCmI,EAAc,eAAed,eAAyBE,IAC5D9H,EAAewI,QAAQZ,IAAgBY,QAAQV,GAC/C/H,EAAaC,EAAcyI,EAAeC,GAE1C,MAAMC,EAAoBT,EAAM3H,cAAc,oBAC1CwH,EAASrF,QACXiG,EAAkBC,UAAY,GAC9BD,EAAkBhE,YAxFO,CAACoD,IAC5B,MAAMc,EAAmBvI,SAASwI,yBAWlC,OATAf,EAASlJ,SAASkK,IAChB,MAAMC,EAAa1I,SAASiE,cAAc,MAC1CyE,EAAW9J,UAAUC,IAAI,kBACzB,MAAM8J,EAAwB,mBAAmBF,IACjDC,EAAW9J,UAAUC,IAAI8J,GACzBD,EAAW5I,YAAc2I,EACzBF,EAAiBlE,YAAYqE,MAGxBH,GA4EyBK,CAAqBnB,KAEnDY,EAAkBtJ,SAGpB,MAAM8J,EAAmBjB,EAAM3H,cAAc,uBAC7CR,EAAaiI,EAAamB,EAAkBnB,GAE5C,MAAMoB,EAAkBlB,EAAM3H,cAAc,kBAC5C,GAAI0H,EAAOvF,OAAQ,CACjB,MAAM2G,EAAaD,EAAgB7I,cAAc,iBACjD6I,EAAgBR,UAAY,GAC5BQ,EAAgBzE,YArFO,EAACsD,EAAQoB,KAClC,MAAMC,EAAiBhJ,SAASwI,yBAQhC,OANAb,EAAOpJ,SAAS0K,IACd,MAAMC,EAAWH,EAAWlB,WAAU,GACtCqB,EAAS1F,IAAMyF,EACfD,EAAe3E,YAAY6E,MAGtBF,GA4EuBG,CAAmBxB,EAAQoB,SAEvDD,EAAgB/J,SAGlB,MAAMqK,EAAcxB,EAAM3H,cAAc,kBAOxC,OANIK,EACF8I,EAAY5F,IAAMlD,EAElB8I,EAAYrK,SAGP6I,GGrEHyB,CAAiBvC,GACjB,CACEwC,YAAY,IAGlB3C,GAAQ4C,KAAKnD,IAKXoD,CAAa1C,OAUX2C,GAAmB5C,IALvBF,GAAQpI,SAAS6H,IACfA,EAAOrH,YAMT6H,GAAcC,IChFV6C,GAAc,CAClB,OAAWtI,GAAWA,GAAS,KAASA,EAAQ,IAChD,IAAQA,GAAUA,EAAQ,IAC1B,KAASA,GAAUA,GAAS,IAC5B,IAAwB,KAAM,GAG1BuI,GAAS3J,SAASC,cAAc,iBAChC2J,GAAgBD,GAAOtJ,iBAAiB,UACxCwJ,GAAiBF,GAAOtJ,iBAAiB,oBAwBzCyJ,GAAe5C,IACnB,MAAM6C,EAAmBC,MAAMrI,KAAKiI,IAAeK,OAAOC,IACxD,MAAMC,EAAaD,EAAOE,KAAKC,MAAM,KAAK,GAC1C,MAfoB,EAACH,EAAQC,EAAYjD,KAC3C,MAAM9F,EAAQ8I,EAAO9I,MACfkJ,EAAUpD,EAAMiD,GACtB,MAAsB,UAAfA,EAAyBT,GAAYtI,GAAOkJ,GAzBxB,QAyBmClJ,GAAwCA,IAAUkJ,EAAQC,YAY/GC,CAAgBN,EAAQC,EAAYjD,MAGvCuD,EAAmBT,MAAMrI,KAAKgI,GAAOtJ,iBAAiB,kBAC5D,OAAO0J,GAbiB,EAACU,EAAkBC,IACpCD,EAAiBR,OAAOU,GACtBD,EAAWE,SAASD,EAAgBvJ,SAWlByJ,CAAkBJ,EAAkBvD,EAAMO,WAmBjEqD,GAAkBjE,GLtBP,EAACjH,EAAImL,KACpB,IAAIC,EAEJ,MAAO,KACDA,GACFjG,OAAOkG,aAAaD,GAGtBA,EAAQE,YAAW,IKSD,CAACrE,IACrB,MAAMsE,EAZU,CAACtE,IACjB,MAAMsE,EAAc,GACpB,IAAIrE,EACJ,IAAK,IAAIsE,EAAI,EAAGA,EAAIvE,EAAIzE,OAAQgJ,IAG9B,GAFAtE,EAAKD,EAAIuE,GACLtB,GAAYhD,EAAGI,QAAUiE,EAAY5B,KAAKzC,GAnD5B,KAoDdqE,EAAY/I,OAA2B,OAAO+I,EAEpD,OAAOA,GAIaE,CAAUxE,GAC9B4C,GAAgB0B,IAG6BG,CAAczE,IA7D5C,OA6De0E,GCxC1BC,GAAqB,CAAClG,GAAYC,IJctC,EAAK3G,UAAUC,IAAI,qBACnBR,EAAgB+B,GGtBhBuJ,GAAO/K,UAAUC,IAAI,2BACrBR,EAAgBwL,ICWlB,IAAI4B,GAAY,GAEhBjG,GAAA,GACM,QAAQ,KCjCE,IAACkG,EAAWC,EL4C1B,EAAK/M,UAAUG,OAAO,qBACtBL,EAAe0B,GIVba,EAAWuK,ICnCEE,EDoCJ7E,ID+Ba,CAACA,IACzB8C,GAAO7K,iBAAiB,SAAUgM,GAAejE,KC/B7C+E,CAAkB/E,GAClB4E,GAAY5E,EAAIgF,MAAM,EDnCN,ICoChBjF,GAAc6E,IDhBlB9B,GAAO/K,UAAUG,OAAO,2BACxBL,EAAemL,KExBW8B,ED0CxB,KACEzG,EAAUX,IC1CduH,MDsBiB,yDCrBdC,MAAMC,GAAaA,EAASC,GAAKD,EAASE,OAASP,MACnDI,MAAMI,GAAST,EAAUS,KACzBC,OAAM,IAAMT,SD4CdU,QACC,CACEnL,IAAKoE,GACLnE,IAAKoE,IF7CE,IEkDb,MAAM+G,GAAc,KAClB,UACA3C,GAAO4C,QACP9C,GAAgBgC,IAChBjG,GAAI6G,QACF,CACEnL,IAAKoE,GACLnE,IAAKoE,IFzDE,IE6DXY,GAAWqG,UAAUhB,IACrBvK,EAAWuK,IACXnM,EAAM4C,kBAAkB,IACxBX,IACAU,EAAkBxC,GAClB0D,EAAkB5C,OAAQmM,EAAWlM,EAAeqD,GACpDG,EAAWlD,GACXmJ,MAAMrI,KAAK,YAAepD,SAASC,IACjCS,EAAgBT,OAIpB,mBAAsB,UAAWsD,ICxEhB,IAAC4J,EAAWC,EAAQe,EDyEnC5K,EAAI6K,iBCzEYjB,ED4Ed,KACExG,EAAUV,GACV8H,MC9EuBX,EDgFzB,KACEzG,EAAUT,ICjFqBiI,EDmFjC,IAAIE,SAAS9K,EAAIC,QClFnB+J,MDgBkB,mDCdhB,CACEe,OAAQ,OACRH,SAGDX,MAAMC,GAAaA,EAASC,GAAKP,IAAcC,MAC/CS,OAAM,IAAMT,SD+EjB3K,EAAYlC,iBAAiB,SAAUgD,IACrCA,EAAI6K,iBACJL,S","file":"main.bundle.js","sourcesContent":["const BORDER_CLASS = 'js-red-border';\nconst BORDER_ANIMATION_CLASS = 'js-animate-border';\n\nconst getWordForm = (number, wordForms) => {\n  let lastTwoCharsNum = number % 100;\n  let lastChar = lastTwoCharsNum % 10;\n\n  if (lastTwoCharsNum > 10 && lastTwoCharsNum < 20) { return wordForms[2]; }\n  if (lastChar === 1) { return wordForms[0]; }\n  if (lastChar > 1 && lastChar < 5) { return wordForms[1]; }\n  if (lastChar > 6 && lastChar < 9 && wordForms[3]) { return wordForms[3]; }\n  if (lastTwoCharsNum === 40 && wordForms[4]) { return wordForms[4]; }\n  if ((lastTwoCharsNum === 90 || lastTwoCharsNum === 0) && wordForms[5]) { return wordForms[5]; }\n  return wordForms[2];\n}\n\nconst disableElements = (elements) => {\n  elements.forEach((element) => {\n    element.disabled = true;\n  })\n}\n\nconst enableElements = (elements) => {\n  elements.forEach((element) => {\n    element.disabled = false;\n  })\n}\n\nconst addRedBorder = (element) => {\n  element.classList.add(BORDER_CLASS);\n  element.classList.add(BORDER_ANIMATION_CLASS);\n\n  element.addEventListener('animationend', () => {\n    element.classList.remove(BORDER_ANIMATION_CLASS);\n  }, { once: true });\n}\n\nconst removeRedBorder = (element) => {\n  if (element.classList.contains(BORDER_CLASS)) {\n    element.classList.remove(BORDER_CLASS);\n  }\n}\n\nconst debounce = (cb, ms) => {\n  let timer;\n\n  return () => {\n    if (timer) {\n      window.clearTimeout(timer);\n    }\n\n    timer = setTimeout(() => cb(), ms)\n  }\n}\n\nexport {\n  getWordForm,\n  disableElements,\n  enableElements,\n  addRedBorder,\n  removeRedBorder,\n  debounce\n};\n","import { getWordForm } from './util.js';\n\nconst apartmentsMap = {\n  'flat': {\n    ruLabel: 'Квартира',\n    price: 1000,\n  },\n  'bungalow': {\n    ruLabel: 'Бунгало',\n    price: 0,\n  },\n  'house': {\n    ruLabel: 'Дом',\n    price: 5000,\n  },\n  'palace': {\n    ruLabel: 'Дворец',\n    price: 10000,\n  },\n};\n\nconst generateFeaturesList = (features) => {\n  const featuresFragment = document.createDocumentFragment();\n\n  features.forEach((feature) => {\n    const newFeature = document.createElement('li');\n    newFeature.classList.add('popup__feature');\n    const newFeatureModificator = `popup__feature--${feature}`;\n    newFeature.classList.add(newFeatureModificator);\n    newFeature.textContent = feature;\n    featuresFragment.appendChild(newFeature);\n  })\n\n  return featuresFragment;\n}\n\nconst generatePhotosList = (photos, popupPhoto) => {\n  const photosFragment = document.createDocumentFragment();\n\n  photos.forEach((photoSrc) => {\n    const newPhoto = popupPhoto.cloneNode(true);\n    newPhoto.src = photoSrc;\n    photosFragment.appendChild(newPhoto);\n  })\n\n  return photosFragment;\n}\n\nconst createCapacityContent = ([roomsNumber, guestsNumber]) => {\n  const roomsWordForm = getWordForm(roomsNumber, ['комната', 'комнаты', 'комнат']);\n  const guestsNumberForm = getWordForm(guestsNumber, ['го', 'х', 'ти', 'ми', 'ка', 'та']);\n  const guestsWordForm = getWordForm(guestsNumber, ['гостя', 'гостей', 'гостей']);\n  return `${roomsNumber} ${roomsWordForm} для ${guestsNumber}-${guestsNumberForm} ${guestsWordForm}`;\n}\n\nconst fillOrRemove = (isDataEnough, element, content, cb, cbParameters) => {\n  if (isDataEnough) {\n    if (cb) { content = cb(cbParameters); }\n    element.textContent = content;\n  } else {\n    element.remove();\n  }\n}\n\nconst adTemplate = document.querySelector('#card')\n  .content\n  .querySelector('.popup');\n\nconst generateAdMarkup = (ad) => {\n  const {\n    author: {avatar},\n    offer: {\n      title,\n      address,\n      price,\n      type,\n      rooms: roomsNumber,\n      guests: guestsNumber,\n      checkin: checkinTime,\n      checkout: checkoutTime,\n      features,\n      description,\n      photos,\n    },\n  } = ad;\n  const newAd = adTemplate.cloneNode(true);\n  newAd.querySelector('.popup__title').textContent = title;\n  newAd.querySelector('.popup__text--address').textContent = address;\n\n  const popupPrice = newAd.querySelector('.popup__text--price')\n  const rate = ' <span>₽/ночь</span>';\n  popupPrice.textContent = `${price}`;\n  popupPrice.insertAdjacentHTML('beforeend', rate);\n\n  const popupType = newAd.querySelector('.popup__type');\n  fillOrRemove(type, popupType, apartmentsMap[type].ruLabel);\n\n  const popupTextCapacity = newAd.querySelector('.popup__text--capacity');\n  let isDataEnough = Boolean(roomsNumber) && Boolean(guestsNumber);\n  fillOrRemove(isDataEnough, popupTextCapacity, '', createCapacityContent, [roomsNumber, guestsNumber]);\n\n  const popupTextTime = newAd.querySelector('.popup__text--time');\n  const timeContent = `Заезд после ${checkinTime}, выезд до ${checkoutTime}`;\n  isDataEnough = Boolean(checkinTime) && Boolean(checkoutTime);\n  fillOrRemove(isDataEnough, popupTextTime, timeContent);\n\n  const popupFeaturesList = newAd.querySelector('.popup__features');\n  if (features.length) {\n    popupFeaturesList.innerHTML = '';\n    popupFeaturesList.appendChild(generateFeaturesList(features));\n  } else {\n    popupFeaturesList.remove();\n  }\n\n  const popupDescription = newAd.querySelector('.popup__description');\n  fillOrRemove(description, popupDescription, description)\n\n  const popupPhotosList = newAd.querySelector('.popup__photos');\n  if (photos.length) {\n    const popupPhoto = popupPhotosList.querySelector('.popup__photo');\n    popupPhotosList.innerHTML = '';\n    popupPhotosList.appendChild(generatePhotosList(photos, popupPhoto));\n  } else {\n    popupPhotosList.remove();\n  }\n\n  const popupAvatar = newAd.querySelector('.popup__avatar');\n  if (avatar) {\n    popupAvatar.src = avatar;\n  } else {\n    popupAvatar.remove();\n  }\n\n  return newAd;\n}\n\nexport { apartmentsMap, generateAdMarkup }\n","import { apartmentsMap } from './generate-ad-markup.js';\nimport { getWordForm, disableElements, enableElements, addRedBorder, removeRedBorder } from './util.js';\n\nconst ADDRESS_DIGITS_NUMBER = 5;\nconst MIN_TITLE_LENGTH = 30;\nconst MAX_TITLE_LENGTH = 100;\nconst MAX_PRICE = 1000000;\nconst EXTRA_ROOMS_VALUE = 100;\nconst EXTRA_GUESTS_VALUE = 0;\nconst EXTRA_GUESTS_MESSAGE = 'Для выбранного количества комнат доступен только вариант \"не для гостей\".';\nconst GUESTS_MESSAGE = 'Количество гостей должно быть не меньше одного и не должно превышать выбранного количества комнат.';\nconst IMAGE_MESSAGE = 'Выберите файл-изображение.';\nconst SYMBOL_WORDS = [\n  'символ',\n  'символа',\n  'символов',\n];\nconst PREVIEW_SIZE = 70;\nconst PREVIEW_ALT = 'Превью фотографии жилья';\n\nconst form = document.querySelector('.ad-form');\nconst fieldsets = form.querySelectorAll('fieldset');\nconst avatar = form.querySelector('#avatar');\nconst avatarPreview = form.querySelector('.ad-form-header__preview img');\nconst title = form.querySelector('#title');\nconst address = form.querySelector('#address');\nconst type = form.querySelector('#type');\nconst price = form.querySelector('#price');\nconst roomsNumber = form.querySelector('#room_number');\nconst guestsNumber = form.querySelector('#capacity');\nconst timeIn = form.querySelector('#timein');\nconst timeOut = form.querySelector('#timeout');\nconst photo = form.querySelector('#images');\nconst photoBox = form.querySelector('.ad-form__photo');\nlet photoPreview;\nconst button = form.querySelector('.ad-form__submit');\nconst resetButton = form.querySelector('.ad-form__reset');\n\nconst disableForm = () => {\n  form.classList.add('ad-form--disabled');\n  disableElements(fieldsets);\n}\n\nconst enableForm = () => {\n  form.classList.remove('ad-form--disabled');\n  enableElements(fieldsets);\n}\n\nconst setAddress = ([lat, lng]) => {\n  address.value = `${lat.toFixed(ADDRESS_DIGITS_NUMBER)}, ${lng.toFixed(ADDRESS_DIGITS_NUMBER)}`;\n}\n\nconst setPriceAttributes = () => {\n  const apartmentPrice = apartmentsMap[type.value].price\n  price.min = apartmentPrice;\n  price.placeholder = apartmentPrice;\n}\n\nsetPriceAttributes();\n\nconst onTypeChange = () => setPriceAttributes();\ntype.addEventListener('change', onTypeChange);\n\nconst syncTimeValues = (from, to) => {\n  to.selectedIndex = from.selectedIndex;\n}\n\nconst onTimeInChange = (evt) => syncTimeValues(evt.target, timeOut);\nconst onTimeOutChange = (evt) => syncTimeValues(evt.target, timeIn);\n\ntimeIn.addEventListener('change', onTimeInChange);\ntimeOut.addEventListener('change', onTimeOutChange);\n\nconst confirmValidation = (element) => {\n  element.setCustomValidity('');\n  removeRedBorder(element);\n}\n\nconst getTitleValidity = (symbolsDifference) => `${symbolsDifference} ${getWordForm(symbolsDifference, SYMBOL_WORDS)}`;\n\nconst onTitleInput = () => {\n  const length = title.value.length;\n\n  if (length < MIN_TITLE_LENGTH) {\n    const symbolsDifference = MIN_TITLE_LENGTH - length;\n    title.setCustomValidity(`Добавьте ещё ${getTitleValidity(symbolsDifference)}.`);\n  } else if (length > MAX_TITLE_LENGTH) {\n    const symbolsDifference = length - MAX_TITLE_LENGTH;\n    title.setCustomValidity(`Уберите лишние ${getTitleValidity(symbolsDifference)}.`);\n  } else {\n    confirmValidation(title);\n  }\n\n  title.reportValidity();\n}\n\ntitle.addEventListener('input', onTitleInput);\n\nconst onPriceInput = () => {\n  const value = price.value;\n\n  if (value > MAX_PRICE) {\n    price.setCustomValidity(`Цена должна быть меньше ${MAX_PRICE}.`);\n  } else {\n    confirmValidation(price);\n  }\n\n  price.reportValidity();\n}\n\nprice.addEventListener('input', onPriceInput);\n\nconst validateGuests = () => {\n  const roomsValue = parseInt(roomsNumber.value);\n  const guestsValue = parseInt(guestsNumber.value);\n\n  let areGuestsSynced;\n  let validityMessage;\n\n  if (roomsValue === EXTRA_ROOMS_VALUE) {\n    areGuestsSynced = guestsValue === EXTRA_GUESTS_VALUE;\n    validityMessage = EXTRA_GUESTS_MESSAGE;\n  } else {\n    areGuestsSynced = guestsValue <= roomsValue && guestsValue !== EXTRA_GUESTS_VALUE;\n    validityMessage = GUESTS_MESSAGE;\n  }\n\n  !areGuestsSynced ? guestsNumber.setCustomValidity(validityMessage) : confirmValidation(guestsNumber);\n\n  guestsNumber.reportValidity();\n};\n\nconst onRoomsNumberChange = () => validateGuests();\nconst onGuestsNumberChange = () => validateGuests();\n\nroomsNumber.addEventListener('change', onRoomsNumberChange);\nguestsNumber.addEventListener('change', onGuestsNumberChange);\n\nconst isImage = (file) => file.type.startsWith('image');\n\nconst setPreviewSrc = (file, block, defaultSrc) => {\n  if (file) {\n    const reader = new FileReader();\n\n    reader.addEventListener('load', () => {\n      block.src = reader.result;\n    })\n\n    reader.readAsDataURL(file);\n  } else {\n    block.src = defaultSrc;\n  }\n}\n\nconst confirmImageValidity = (input) => {\n  input.setCustomValidity('');\n  removeRedBorder(input.nextElementSibling);\n}\n\nconst confirmAndPreview = (input, file, preview, defaultSrc) => {\n  confirmImageValidity(input);\n  setPreviewSrc(file, preview, defaultSrc);\n}\n\nconst defaultAvatar = avatarPreview.src;\n\nconst onAvatarChange = () => {\n  const file = avatar.files[0];\n\n  if (!file || isImage(file)) {\n    confirmAndPreview(avatar, file, avatarPreview, defaultAvatar);\n  } else {\n    avatar.setCustomValidity(IMAGE_MESSAGE);\n    if (avatarPreview.src !== defaultAvatar) {\n      avatarPreview.src = defaultAvatar;\n    }\n  }\n\n  avatar.reportValidity();\n}\n\nconst isPreviewAdded = () => photoBox.contains(photoPreview);\n\nconst removePreview = () => {\n  if (isPreviewAdded()) {\n    photoPreview.remove();\n  }\n}\n\nconst resetPhoto = (input) => {\n  confirmImageValidity(input);\n  removePreview();\n}\n\nconst onPhotoChange = () => {\n  const file = photo.files[0];\n\n  if (!photoPreview) {\n    photoPreview = document.createElement('img');\n    photoPreview.width = PREVIEW_SIZE;\n    photoPreview.height = PREVIEW_SIZE;\n    photoPreview.alt = PREVIEW_ALT;\n  }\n\n  if (!file) {\n    resetPhoto(photo);\n  } else {\n    if (!isImage(file)) {\n      photo.setCustomValidity(IMAGE_MESSAGE);\n      removePreview();\n    } else {\n      confirmAndPreview(photo, file, photoPreview);\n      if (!isPreviewAdded()) {\n        photoBox.appendChild(photoPreview);\n      }\n    }\n  }\n\n  photo.reportValidity();\n}\n\navatar.addEventListener('change', onAvatarChange);\nphoto.addEventListener('change', onPhotoChange);\n\nconst highlightInvalidFields = () => {\n  const invalidElements = form.querySelectorAll('input:invalid, select:invalid');\n  invalidElements.forEach((element) => element.type === 'file' ? addRedBorder(element.nextElementSibling) : addRedBorder(element));\n}\n\nbutton.addEventListener('click', highlightInvalidFields);\n\nexport {\n  form,\n  avatar,\n  avatarPreview,\n  price,\n  guestsNumber,\n  photo,\n  resetButton,\n  disableForm,\n  enableForm,\n  setAddress,\n  setPriceAttributes,\n  defaultAvatar,\n  confirmValidation,\n  confirmAndPreview,\n  resetPhoto\n};\n","const ESCAPE_CODE = 'Escape';\n\nconst main = document.querySelector('main');\nconst requestError = document.querySelector('#request-error')\n  .content\n  .querySelector('.error');\nconst postingSuccess = document.querySelector('#success')\n  .content\n  .querySelector('.success');\nconst postingError = document.querySelector('#error')\n  .content\n  .querySelector('.error');\nconst errorButton = postingError.querySelector('.error__button')\n\nconst cleanPopup = (popup) => {\n  popup.remove();\n  popup.removeEventListener('click', onPopupClick);\n  window.removeEventListener('keydown', onWindowKeydown);\n}\n\nconst createOnPopupClick = (popup) => () => cleanPopup(popup);\n\nconst createOnWindowKeydown = (popup) => {\n  return (evt) => {\n    if (evt.code === ESCAPE_CODE) {\n      cleanPopup(popup);\n    }\n  }\n}\n\nconst onErrorButtonClick = () => {\n  cleanPopup(postingError);\n  errorButton.removeEventListener('click', onErrorButtonClick)\n}\n\nlet onPopupClick;\nlet onWindowKeydown;\n\nconst showPopup = (popup) => {\n  main.appendChild(popup);\n  popup.addEventListener('click', onPopupClick = createOnPopupClick(popup));\n  window.addEventListener('keydown', onWindowKeydown = createOnWindowKeydown(popup));\n  if (popup.contains(errorButton)) {\n    errorButton.addEventListener('click', onErrorButtonClick)\n  }\n}\n\nexport { postingSuccess, postingError, requestError, showPopup };\n","/* global L:readonly */\nimport { generateAdMarkup } from './generate-ad-markup.js';\nimport { setAddress } from './form.js';\n\nconst CENTER_LAT = 35.681700;\nconst CENTER_LNG = 139.753882;\nconst ZOOM = 10;\nconst MAIN_MARKER_SIZE = 50;\nconst MARKER_SIZE = 40;\n\nconst map = L.map('map-canvas');\n\nL.tileLayer(\n  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  },\n).addTo(map);\n\nconst mainMarkerIcon = L.icon ({\n  iconUrl: '../img/main-pin.svg',\n  iconSize: [MAIN_MARKER_SIZE, MAIN_MARKER_SIZE],\n  iconAnchor: [MAIN_MARKER_SIZE / 2, MAIN_MARKER_SIZE],\n});\n\nconst mainMarker = L.marker(\n  {\n    lat: CENTER_LAT,\n    lng: CENTER_LNG,\n  },\n  {\n    draggable: true,\n    icon: mainMarkerIcon,\n  },\n);\n\nmainMarker.addTo(map);\n\nmainMarker.on('move', (evt) => {\n  const coordinates = [evt.target.getLatLng().lat, evt.target.getLatLng().lng]\n  setAddress(coordinates);\n});\n\nconst markerIcon = L.icon ({\n  iconUrl: '../img/pin.svg',\n  iconSize: [MARKER_SIZE, MARKER_SIZE],\n  iconAnchor: [MARKER_SIZE / 2, MARKER_SIZE],\n});\n\nconst markers = [];\n\nconst createMarker = (ad) => {\n  const marker = L.marker(\n    {\n      lat: ad.location.lat,\n      lng: ad.location.lng,\n    },\n    {\n      icon: markerIcon,\n    },\n  )\n  marker\n    .addTo(map)\n    .bindPopup(\n      generateAdMarkup(ad),\n      {\n        keepInView: true,\n      },\n    );\n  markers.push(marker);\n}\n\nconst createMarkers = (ads) => {\n  ads.forEach((ad) => {\n    createMarker(ad);\n  })\n}\n\nconst removeMarkers = () => {\n  markers.forEach((marker) => {\n    marker.remove();\n  })\n}\n\nconst reCreateMarkers = (ads) => {\n  removeMarkers();\n  createMarkers(ads);\n}\n\nexport { CENTER_LAT, CENTER_LNG, ZOOM, map, mainMarker, createMarkers, reCreateMarkers };\n","import { reCreateMarkers } from './map.js';\nimport { disableElements, enableElements, debounce } from './util.js';\n\nconst MAX_ADS_COUNT = 10;\nconst INTERVAL = 500;\nconst DEFAULT_SELECT_VALUE = 'any';\nconst priceFilter = {\n  'middle': (value) => (value >= 10000 && value < 50000),\n  'low': (value) => value < 10000,\n  'high': (value) => value >= 50000,\n  [DEFAULT_SELECT_VALUE]: () => true,\n};\n\nconst filter = document.querySelector('.map__filters');\nconst selectFilters = filter.querySelectorAll('select');\nconst filterElements = filter.querySelectorAll('select, fieldset');\n\nconst disableFilter = () => {\n  filter.classList.add('.map__filters--disabled');\n  disableElements(filterElements);\n}\n\nconst enableFilter = () => {\n  filter.classList.remove('.map__filters--disabled');\n  enableElements(filterElements);\n}\n\nconst isSelectMatched = (select, selectType, offer) => {\n  const value = select.value;\n  const adValue = offer[selectType];\n  return selectType === 'price' ? priceFilter[value](adValue) : value === DEFAULT_SELECT_VALUE ? true : value === adValue.toString();\n}\n\nconst isFeaturesMatched = (selectedFeatures, adFeatures) => {\n  return selectedFeatures.every((selectedFeature) => {\n    return adFeatures.includes(selectedFeature.value);\n  })\n}\n\nconst isAdMatched = (offer) => {\n  const isSelectsMatched = Array.from(selectFilters).every((select) => {\n    const selectType = select.name.split('-')[1];\n    return isSelectMatched(select, selectType, offer);\n  })\n\n  const selectedFeatures = Array.from(filter.querySelectorAll('input:checked'));\n  return isSelectsMatched && isFeaturesMatched(selectedFeatures, offer.features);\n}\n\nconst filterAds = (ads) => {\n  const filteredAds = [];\n  let ad;\n  for (let i = 0; i < ads.length; i++) {\n    ad = ads[i];\n    if (isAdMatched(ad.offer)) { filteredAds.push(ad) }\n    if (filteredAds.length === MAX_ADS_COUNT) {return filteredAds}\n  }\n  return filteredAds;\n}\n\nconst filterMarkers = (ads) => {\n  const filteredAds = filterAds(ads);\n  reCreateMarkers(filteredAds);\n}\n\nconst onFilterChange = (ads) => debounce(() => filterMarkers(ads), INTERVAL);\n\nconst setFilterListener = (ads) => {\n  filter.addEventListener('change', onFilterChange(ads));\n}\n\nexport { MAX_ADS_COUNT, filter, disableFilter, enableFilter, filterMarkers, setFilterListener };\n","import {\n  form,\n  avatar,\n  avatarPreview,\n  price,\n  photo,\n  defaultAvatar,\n  resetButton,\n  guestsNumber,\n  disableForm,\n  enableForm,\n  setPriceAttributes,\n  setAddress,\n  confirmValidation,\n  confirmAndPreview,\n  resetPhoto\n} from './form.js';\nimport { requestError, postingSuccess, postingError, showPopup } from './popup.js';\nimport { MAX_ADS_COUNT, filter, disableFilter, enableFilter, setFilterListener } from './filter.js';\nimport { CENTER_LAT, CENTER_LNG, ZOOM, map, mainMarker, createMarkers, reCreateMarkers } from './map.js';\nimport { getData, sendData } from './server.js';\nimport { removeRedBorder } from './util.js';\n\nconst SERVER_GET = 'https://22.javascript.pages.academy/keksobooking/data';\nconst SERVER_POST = 'https://22.javascript.pages.academy/keksobooking';\nconst CENTER_COORDINATES = [CENTER_LAT, CENTER_LNG];\n\ndisableForm();\ndisableFilter();\n\nlet slicedAds = [];\n\nmap\n  .on('load', () => {\n    enableForm();\n    setAddress(CENTER_COORDINATES);\n    getData((ads) => {\n      setFilterListener(ads);\n      slicedAds = ads.slice(0, MAX_ADS_COUNT)\n      createMarkers(slicedAds);\n      enableFilter();\n    },\n    () => {\n      showPopup(requestError);\n    },\n    SERVER_GET,\n    );\n  })\n  .setView(\n    {\n      lat: CENTER_LAT,\n      lng: CENTER_LNG,\n    },\n    ZOOM,\n  );\n\nconst setDefaults = () => {\n  form.reset();\n  filter.reset();\n  reCreateMarkers(slicedAds);\n  map.setView(\n    {\n      lat: CENTER_LAT,\n      lng: CENTER_LNG,\n    },\n    ZOOM,\n  )\n  mainMarker.setLatLng(CENTER_COORDINATES);\n  setAddress(CENTER_COORDINATES);\n  price.setCustomValidity('');\n  setPriceAttributes();\n  confirmValidation(guestsNumber);\n  confirmAndPreview(avatar, undefined, avatarPreview, defaultAvatar);\n  resetPhoto(photo);\n  Array.from(form.elements).forEach((element) => {\n    removeRedBorder(element);\n  });\n}\n\nform.addEventListener('submit', (evt) => {\n  evt.preventDefault();\n\n  sendData(\n    () => {\n      showPopup(postingSuccess);\n      setDefaults();\n    },\n    () => {\n      showPopup(postingError);\n    },\n    new FormData(evt.target),\n    SERVER_POST,\n  );\n});\n\nresetButton.addEventListener('click', (evt) => {\n  evt.preventDefault();\n  setDefaults();\n});\n","const getData = (onSuccess, onFail, url) => {\n  fetch(url)\n    .then((response) => response.ok ? response.json() : onFail())\n    .then((data) => onSuccess(data))\n    .catch(() => onFail());\n}\n\nconst sendData = (onSuccess, onFail, body, url) => {\n  fetch(\n    url,\n    {\n      method: 'POST',\n      body,\n    },\n  )\n    .then((response) => response.ok ? onSuccess() : onFail())\n    .catch(() => onFail());\n}\n\nexport { getData, sendData };\n"],"sourceRoot":""}